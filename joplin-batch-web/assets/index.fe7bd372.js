var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o;import{C as s,b as c}from"./vendor.f9e4dcb2.js";import{n as l,j as p,B as d}from"./joplinApiGenerator.e693c4a0.js";import{C as m}from"./index.b1748e28.js";import{L as u}from"./index.edc0b3e1.js";import{w as f}from"./comlink.2c5abf4e.js";import{f as b}from"./index.esm.84052b48.js";import{P as y}from"./PromiseUtil.6ae62114.js";import{i as x}from"./index.5ebcd3da.js";function w(){return new Worker("./assets/parseInternalLink.81e817aa.js",{type:"module"})}var g="_subList_1op68_1";const h=new class{constructor(e){this.config=e,this.parseInternalLinkWorker=f(new w)}check(){return y.warpOnEvent((async e=>{e.load("开始加载所有附件资源");const s=new Set((await this.getAllResourceIdList()).map((e=>e.id)));e.load("开始加载所有笔记");const c=await l.pageToAllList(this.config.noteApi.list.bind(this.config.noteApi),{fields:["id","title","body","user_updated_time"]}),p=c.reduce(((e,t)=>e.add(t.id)),new Set);e.load("开始解析所有笔记");let d=0;return(await b.map(c,(async s=>{const l=(p=((e,t)=>{for(var r in t||(t={}))n.call(t,r)&&i(e,r,t[r]);if(o)for(var r of o(t))a.call(t,r)&&i(e,r,t[r]);return e})({},s),m={resources:await this.parseInternalLinkWorker(s.body)},t(p,r(m)));var p,m;return d++,e.parse({rate:d,all:c.length,title:s.title||"未知文件名"}),l}))).filter((e=>(e.resources=e.resources.filter((e=>!s.has(e.id)&&!p.has(e.id))),0!==e.resources.length))).map((e=>{var t=e,{body:r}=t;return((e,t)=>{var r={};for(var i in e)n.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&o)for(var i of o(e))t.indexOf(i)<0&&a.call(e,i)&&(r[i]=e[i]);return r})(t,["body"])}))}))}async getAllResourceIdList(){return await l.pageToAllList(this.config.resourceApi.list.bind(this.config.resourceApi),{fields:["id","title","mime"]})}}(p),j=()=>{const[e,t]=s.exports.useState([]),[r,o]=s.exports.useState(""),[n,a]=c((async()=>{const e=await h.check().on("load",(e=>o(e))).on("parse",(e=>{o(`[${e.rate}/${e.all}] ${e.title}`)}));console.log("list: ",e),t(e)}));return s.exports.createElement(m,{title:x.t("notFoundResource.title"),extra:s.exports.createElement(d,{onClick:a},x.t("notFoundResource.action.check"))},s.exports.createElement(u,{dataSource:e,locale:{emptyText:x.t("notFoundResource.listEmptyText")},renderItem:e=>s.exports.createElement(u.Item,{key:e.id,actions:[s.exports.createElement(d,{onClick:()=>async function(e){await p.noteActionApi.openAndWatch(e)}(e.id)},x.t("notFoundResource.action.open"))]},s.exports.createElement(u.Item.Meta,{title:e.title,description:s.exports.createElement(u,{className:g,dataSource:e.resources,renderItem:e=>s.exports.createElement(u.Item,{key:e.id},s.exports.createElement(u.Item.Meta,{title:e.title||x.t("notFoundResource.unknownFileName",e)}))})})),loading:{spinning:n.loading,tip:r}}))};export{j as default};
