var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;import{w as n,C as l,j as c,B as p,l as d}from"./vendor.33de8da3.js";import{s as m,j as u}from"./joplinApiGenerator.193dcce8.js";import{f}from"./index.esm.84052b48.js";import{P as y}from"./PromiseUtil.a7bff535.js";import{u as b}from"./useAsyncFn.fc0513d1.js";import"./index.5d30d163.js";function g(){return new Worker("./assets/parseInternalLink.c122abd2.js",{type:"module"})}var w="_subList_1op68_1";const x=new class{constructor(e){this.config=e,this.parseInternalLinkWorker=n(new g)}check(){return y.warpOnEvent((async e=>{e.load("开始加载所有附件资源");const n=new Set((await this.getAllResourceIdList()).map((e=>e.id)));e.load("开始加载所有笔记");const l=await m.pageToAllList(this.config.noteApi.list.bind(this.config.noteApi),{fields:["id","title","body","user_updated_time"]}),c=l.reduce(((e,t)=>e.add(t.id)),new Set);e.load("开始解析所有笔记");let p=0;return(await f.map(l,(async n=>{const c=(d=((e,t)=>{for(var r in t||(t={}))o.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))i.call(t,r)&&s(e,r,t[r]);return e})({},n),m={resources:await this.parseInternalLinkWorker(n.body)},t(d,r(m)));var d,m;return p++,e.parse({rate:p,all:l.length,title:n.title||"未知文件名"}),c}))).filter((e=>(e.resources=e.resources.filter((e=>!n.has(e.id)&&!c.has(e.id))),0!==e.resources.length))).map((e=>{var t=e,{body:r}=t;return((e,t)=>{var r={};for(var s in e)o.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&a)for(var s of a(e))t.indexOf(s)<0&&i.call(e,s)&&(r[s]=e[s]);return r})(t,["body"])}))}))}async getAllResourceIdList(){return await m.pageToAllList(this.config.resourceApi.list.bind(this.config.resourceApi),{fields:["id","title","mime"]})}}(u);export default()=>{const[e,t]=l.exports.useState([]),[r,a]=l.exports.useState(""),[o,i]=b((async()=>{const e=await x.check().on("load",(e=>a(e))).on("parse",(e=>{a(`[${e.rate}/${e.all}] ${e.title}`)}));console.log("list: ",e),t(e)}));return l.exports.createElement(c,{title:"检查笔记中引用失效的资源",extra:l.exports.createElement(p,{onClick:i},"检查")},l.exports.createElement(d,{dataSource:e,locale:{emptyText:"没有找到任何引用失效的资源"},renderItem:e=>l.exports.createElement(d.Item,{key:e.id,actions:[l.exports.createElement(p,{onClick:()=>async function(e){await u.noteActionApi.openAndWatch(e)}(e.id)},"打开")]},l.exports.createElement(d.Item.Meta,{title:e.title,description:l.exports.createElement(d,{className:w,dataSource:e.resources,renderItem:e=>l.exports.createElement(d.Item,{key:e.id},l.exports.createElement(d.Item.Meta,{title:e.title||`未知文件名 ${e.id}`}))})})),loading:{spinning:o.loading,tip:r}}))};
